
# 系统实现 #

## 常量 ##

### 委托类型 ###

1: 债权代理
2: 债权转让

### 委托单的状态 ###

0: 未审核；
1: 已通过；
2: 未通过；
3: 已成交；
4: 已完成；

## 约定 ##

### 时间存储 ###

后台存储到 MongoDB 是整形，单位为秒。
注意 js 通过 `getTime` 取到的单位是毫秒。 因此，存储的时候，需要先除以1000，再传到后台。
同理，从后台读出来的时间，如果要转成 js 变量，需要先乘以1000。

### 金额存储 ###

金额存储到 MongoDB 同样是整形，单位是分。
因此，前台界面上，用户输入的单位如果是元，那么，在提交到后台的时候，需要先乘以100后再提交。
同理，从后台读取金额数据到前台展现时，需要除以100，将单位转换为元。

### 文件上传 ###

用户id, 唯一key

## 业务逻辑 ##

### 催收动态 ###

#### 列表显示的条件 ####

满足以下规则时，催收动态列表才会显示出来:
* 委托单的类型为"债权代理"
* 状态为"已成交"
* 只有发布人与中标人能看

#### 更新催收动态的条件 ####

* 满足 [列表显示条件]() 
* 当前用户为中标人.

### 我要中标 ###

满足以下规则时，隐藏"我要中标"：
* 委托单的状态必须为"未完成"(< 已成交)
* 当前查看人既不是"发布人"，也不是"中标人"

### 倒计时 ###

* 当状态为未成交时,显示"距离竞拍结束"的倒计时
* 当状态为已成交时,发布人和中标人,仍然可以看到倒计时,此时的倒计时,是"距离此债务单催收结
束"的倒计时
* 当状态为已成交，跟此单无关的人员，应该看不到倒计时

### 债务明细状态显示 ###

* 单的状态:"竞标中"，什么都不显示，只显示倒计时
* 单的状态:"竞标中"，并且当前用户已投过标，显示"你已投过标"
* 单的状态:"已中标"，对于发布人和中标人，显示"距离催收结束的倒计时",不显示状态
* 单的状态:"已中标"，对于竞过此标的用户，显示"已结束".
* 单的状态:"已完成"，不管任何人，显示"已结束"

### 竞标列表 ###

#### 中标按钮显示条件 ####

满足以下规则时，才显示"中标"按钮：
* 委托单的状态为"未完成"
* 当前查看的人为"发布人"
* 类型为:债权代理

#### 中标标记 ####

满足以下规则时，才显示"中标"标记：
* 状态为"已完成"
* 竞标者ID等于获胜者ID


### 权限校验 ###

* 创建委托单,必须满足的权限: 通过手机验证 或者 通过邮箱验证
* 应标的权限: 通过身份认证(上传身份证+无犯罪记录等)

# 业务规则 #

## 竞标模式与中标模式 ##

* 债权代理
代理采用的是竞标模式。每个人竞标时，填写自己收取的代理费率。由发布人自由决定选择哪一家代理商可以中得此标。
中标后，委托单状态为已成交，进行催收阶段。
代理商需要每周更新催收进度。

* 债权转让
转让采用的是拍卖模式。每个人竞标时，填写自己竞标价格。最终拍卖时间结束后，价高者胜出。
拍卖结束后，整个单的状态也变成已完成?

## 用户相关的债务 ##

* 我的委托 (我发布的记录)
* 我的竞标 (参与的竞标,并且没有中标)
* 我的中标

## 信用等级 ##

* 无犯罪记录证明;信用报告; 各5分;
* 初始(1级): 10分
* 2级: 20分
* 3级: 40分
* 4级: 80分

## 催债人 ##

* 身份证是必须的;
* 无犯罪记录,信用报告可选; 如果上传则各加多5分;

## 债务权限 ##

* 债务列表是都允许查看的
* 只有通过身份认证，才允许查看债务明细
* 创建债务: 要求手机,邮箱,身份认证;3中任何1个通过认证后才允许创建债务

## 流程 ##

1. 用户注册完,只要通过手机验证或者邮箱验证后,就可以发布委托。
2. 发布委托的时候，用户需要上传债权人的身份证。
   - 债权人有可能不是发布人自己，因为发布人有可能是帮别人代发委托
   - 如果发布人已上传了身份证等信息，要默认带上这些信息，在发布委托的时候，允许修改
3. 只有上传之后才允许发布。
4. 应标人必须通过身份认证(上传无犯罪记录)后，才允许接单.

